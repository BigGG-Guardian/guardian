server:
  port: 49999
  servlet:
    context-path: /guardian-example

spring:
  # Redis 相关配置
  redis:
    host: 127.0.0.1
    port: 6379
    database: 0
#    password:

guardian:
  # 请求体缓存过滤器排序（全局共享，防重 / 幂等模块共用，默认 -100）
  repeatable-filter-order: -100

  # ==================== 防重复提交配置 ====================
  # 也可使用 @RepeatSubmit 注解，YAML 优先级高于注解
  repeat-submit:
    # 存储方式：redis（默认）/ local
    storage: redis
    # Key 加密策略：none（默认）/ md5
    key-encrypt: md5
    # 响应模式：exception（默认，抛异常）/ json（直接返回 JSON）
    response-mode: json
    # 是否打印拦截日志（默认 false）/ true
    log-enabled: true

    # YAML 批量 URL 防重规则
    urls:
      - pattern: /guardian-example/repeat-submit/yml/**
        interval: 10
        key-scope: user

    # 排除规则（白名单，优先级最高，命中直接放行）
    exclude-urls:
      - /guardian-example/repeat-submit/yml/whitelist

  # ==================== 接口限流配置 ====================
  # 也可使用 @RateLimit 注解，YAML 优先级高于注解
  # 限流总量公式：maxCount = qps × window（秒）
  rate-limit:
    # 总开关（默认 true），设为 false 可完全关闭限流功能
    enabled: true
    # 存储方式：redis（默认）/ local
    storage: redis
    # 响应模式：exception（默认，抛异常）/ json（直接返回 JSON）
    response-mode: json
    # 是否打印拦截日志（默认 false）/ true
    log-enabled: true

    # YAML 批量 URL 限流规则
    urls:
      # 滑动窗口 — 模拟搜索接口 — 全局限流：2 QPS × 1s = 每秒最多 2 次
      - pattern: /guardian-example/rate-limit/yml/search
        qps: 2
        window: 1
        window-unit: seconds
        rate-limit-scope: global

      # 滑动窗口 — 模拟短信接口 — IP 限流：1 QPS × 1s = 同一 IP 每秒最多 1 次
      - pattern: /guardian-example/rate-limit/yml/sms
        qps: 1
        window: 1
        window-unit: seconds
        rate-limit-scope: ip
        message: "短信发送过于频繁"

      # 令牌桶 — 模拟秒杀接口 — 全局限流：每秒补充 2 个令牌，桶容量 5（允许突发 5 次）
      - pattern: /guardian-example/rate-limit/yml/seckill
        qps: 2
        capacity: 5
        algorithm: token_bucket
        rate-limit-scope: global
        message: "抢购太火爆，请稍后重试"

    # 排除规则（白名单，优先级最高，命中直接放行）
    exclude-urls:
      - /guardian-example/rate-limit/yml/whitelist

  # ==================== 请求参数自动trim配置 ====================
  auto-trim:
    # 总开关（默认 true）
    enabled: true
    # Filter 排序（值越小越先执行，默认 -10000）
    filter-order: -10000
    # 排除字段列表（表单参数 + JSON body 字段统一生效，这些字段不会被 trim）
    exclude-fields:
      - password
      - signature
    # 字符替换规则（先替换后 trim，from 支持转义：\\r \\n \\t \\uXXXX）
    character-replacements:
      - from: "\\r"
        to: ""
      - from: "\\u200B"
        to: ""
      - from: "\\uFEFF"
        to: ""

  # ==================== 慢接口检测配置 ====================
  slow-api:
    # 总开关（默认 true）
    enabled: true
    # 慢接口阈值（毫秒，默认 3000）
    threshold: 3000
    # 拦截器排序（值越小越先执行，默认 -1000）
    interceptor-order: -1000
    # 排除规则（白名单，命中直接跳过检测）
    exclude-urls:
      - /guardian-example/slow-api/health

  # ==================== 请求链路 TraceId 配置 ====================
  trace:
    # 总开关（默认 true）
    enabled: true
    # Filter 排序（值越小越先执行，默认 -20000，最先执行以覆盖全链路）
    filter-order: -20000
    # TraceId 请求头/响应头名称（默认 X-Trace-Id）
    header-name: X-Trace-Id

  # ==================== 接口幂等配置 ====================
  idempotent:
    # 总开关（默认 true）
    enabled: true
    # 存储方式：redis（默认）/ local
    storage: redis
    # Token 有效期（默认 300）
    timeout: 10
    # Token 有效期单位（默认秒）
    time-unit: seconds
    # 响应模式：exception（默认，抛异常）/ json（直接返回 JSON）
    response-mode: json
    # 是否打印拦截日志（默认 false）/ true
    log-enabled: true
    # 是否注册内置 Token 获取接口（默认 true）
    token-endpoint: true
    # 是否启用结果缓存（默认 false，启用后重复请求返回首次结果而非拒绝）
    result-cache: true

# Actuator 监控端点的配置项
management:
  endpoints:
    web:
      base-path: /actuator
      exposure:
        include: '*'
